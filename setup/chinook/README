
Installing MTUQ on chinook
--------------------------

Clone mtuq in a directory of your choice:

    > git clone https://github.com/uafgeotools/mtuq


Then run the installation script:

    > cd mtuq
    > bash setup/chinook/install.bash


NOTES 

- `install.bash` loads required chinook modules and creates a virtual
environment that can be used during the current session and any subsequent
sessions.  

- The resulting virtual environment is "editable", which means that any changes
to the python code go into effect immediately without having to reinstall. 

- If the installation procedure fails, there is possibly a conflict between
modules. Try `module purge` and then rerun `install.bash`.

- Advanced users can obtain the same result as `install.bash` by following the
more general instructions in `docs/`.



Activating the MTUQ virtual environment
---------------------------------------

At the beginning of a session, users must activate the virtual environment:

   > source setup/chinook/activate.bash

At the end of a session, it is a good idea to deactivate the environment:

   > deactivate



Running the examples
--------------------

After activating the virtual environment, users can run either the serial
example located in `examples/` or the parallel examples located in
`setup/chinook/examples/`.


The serial example can be invoked directly:

    > python SerialGridSearch.DoubleCouple.py


The parallel examples must be invoked using an sbatch wrapper, e.g.:

    > sbatch submit.bash GridSearch.DoubleCouple.py


NOTES

- The above examples reproduce results from Silwal2016.

- Recorded seismic data from the main Silwal2016 test case are included in the
MTUQ repository, so it is not necessary to redownload them.

- The serial example uses the syngine webservice to obtain AxiSEM Green's
functions.  The parallel example uses a local chinook databaset to obtain
FK Green's functions, similar to the legacy program CAP.



Modifying the examples
----------------------

To obtain moment tensor estimates for events other than the main Silwal2016 
event, users can download waveforms using uafgeotools/pysep and modify the MTUQ
examples as follows:

- Change `path_data` to the pysep download directory

- Change `path_weights` to the CAP-style weight file included with the pysep
 download

- Change the `magnitude` keyword arguments to the desired value for the
current event, or to the desired list of magnitudes if you wish to include
magnitude as a search parameter

- Optionally, adjust the Earth model, data processing and misfit settings.
(Default choices match Silwal2016.)



References
----------

[Silwal2016] Vipul Silwal and Carl Tape (2016), Seismic moment tensors and 
estimated uncertainties in southern Alaska, JGR, https://doi.org/10.1002/2015JB012588



